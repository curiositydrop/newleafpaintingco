<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Experience | New Leaf Painting Co.</title>
  <meta name="description" content="A fun, interactive portal into the New Leaf Painting experience. Pick a leaf, reveal a deal, and try a daily bonus spin." />

  <style>
    :root{
      --bg:#000;
      --panel: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);

      /* ✅ Your green */
      --green:#1f6b33;

      /* Glow accent */
      --glow: rgba(80,255,160,.28);
      --glow2: rgba(80,255,160,.18);
    }

    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; background:var(--bg); color:var(--text); overflow-x:hidden; }
    a{ color:inherit; text-decoration:none; }

    /* ===== Ambient portal background ===== */
    .portal-bg{
      position: fixed;
      inset: 0;
      z-index: -2;
      background:
        radial-gradient(900px 420px at 50% 0%, rgba(80,255,160,.14), transparent 60%),
        radial-gradient(700px 420px at 15% 30%, rgba(31,107,51,.16), transparent 65%),
        radial-gradient(700px 420px at 85% 35%, rgba(80,255,160,.10), transparent 60%),
        #000;
      filter: saturate(1.08);
    }
    .grain{
      position: fixed;
      inset:0;
      z-index:-1;
      pointer-events:none;
      opacity:.09;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    .wrap{
      max-width: 1080px;
      margin: 0 auto;
      padding: 18px 14px 70px;
    }

    /* ===== Top bar ===== */
    .topbar{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 12px;
      padding: 10px 0 16px;
      flex-wrap: wrap;
    }

    .leaf-brand{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .leaf-logo{
      width: 58px;
      height: 58px;
      border-radius: 16px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 0 22px rgba(80,255,160,.18);
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .leaf-logo img{
      width: 94%;
      height: 94%;
      object-fit: contain;
      display:block;
      filter: drop-shadow(0 0 12px rgba(80,255,160,.25));
    }

    .leaf-title{
      display:flex;
      flex-direction:column;
      line-height:1.15;
      min-width:0;
    }
    .leaf-title strong{
      font-size: 14px;
      letter-spacing: .2px;
      color: rgba(255,255,255,.92);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .leaf-title span{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .top-actions{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    /* ===== Buttons ===== */
    .nl-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      letter-spacing: .2px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .nl-btn:hover{ transform: translateY(-1px); filter: brightness(1.06); background: rgba(255,255,255,.09); }
    .nl-btn.primary{
      border-color: rgba(80,255,160,.28);
      background: linear-gradient(180deg, rgba(31,107,51,.40), rgba(31,107,51,.18));
      box-shadow: 0 0 22px rgba(80,255,160,.16);
    }
    .nl-btn.ghost{
      background: transparent;
      border-color: rgba(255,255,255,.18);
    }
    .nl-btn.disabled{
      opacity:.5;
      pointer-events:none;
      filter: grayscale(.1);
    }

    /* ===== Hero ===== */
    .hero{
      margin-top: 6px;
      padding: 18px 16px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow:
        0 18px 50px rgba(0,0,0,.55),
        0 0 34px rgba(80,255,160,.12);
      overflow:hidden;
      position:relative;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:-60px -40px auto -40px;
      height: 220px;
      background: radial-gradient(closest-side, rgba(80,255,160,.20), transparent 70%);
      filter: blur(10px);
      opacity:.85;
    }
    .hero h1{
      margin: 0 0 8px;
      font-size: clamp(1.5rem, 3.2vw, 2.2rem);
      letter-spacing: .3px;
      color: rgba(80,255,160,.95);
      text-shadow: 0 0 14px rgba(80,255,160,.18);
      position:relative;
    }
    .hero p{
      margin: 0;
      max-width: 860px;
      color: rgba(255,255,255,.84);
      line-height: 1.55;
      position:relative;
    }

    .type-line{
      margin-top: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: rgba(255,255,255,.82);
      font-size: 13px;
      background: rgba(0,0,0,.38);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 10px 12px;
      position:relative;
    }
    .cursor{
      display:inline-block;
      width: 10px;
      height: 16px;
      transform: translateY(2px);
      background: rgba(80,255,160,.9);
      margin-left: 3px;
      animation: blink .9s steps(1) infinite;
      border-radius: 2px;
    }
    @keyframes blink{ 50%{ opacity:0; } }

    /* ===== Cards/sections ===== */
    .card{
      margin-top: 14px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 12px 28px rgba(0,0,0,.45);
    }
    .card h2{
      margin: 0 0 10px;
      color: rgba(80,255,160,.92);
      letter-spacing: .2px;
      font-size: 1.15rem;
    }
    .card p{
      margin: 0 0 10px;
      color: rgba(255,255,255,.78);
      line-height: 1.55;
    }

    /* ===== Step 1: service picks ===== */
    .chips{
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .chip{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      font-weight: 900;
      color: rgba(255,255,255,.90);
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      user-select:none;
    }
    .chip:hover{ transform: translateY(-1px); filter: brightness(1.06); }
    .chip.active{
      background: linear-gradient(180deg, rgba(31,107,51,.44), rgba(31,107,51,.18));
      border-color: rgba(80,255,160,.30);
      box-shadow: 0 0 20px rgba(80,255,160,.12);
    }

    .mini-note{
      margin-top: 10px;
      font-size: 13px;
      color: rgba(255,255,255,.70);
    }

    /* ===== Step 2: Pick a leaf ===== */
    .pick-grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 900px){ .pick-grid{ grid-template-columns: 1fr; } }

    .leaf-card{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      padding: 14px;
      box-shadow: 0 12px 28px rgba(0,0,0,.45);
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, background .12s ease, border-color .12s ease;
      position: relative;
      overflow:hidden;
    }
    .leaf-card:hover{ transform: translateY(-2px); filter: brightness(1.05); }
    .leaf-card img{
      width: 100%;
      max-height: 220px;
      object-fit: contain;
      display:block;
      margin: 0 auto 8px;
      filter: drop-shadow(0 0 14px rgba(80,255,160,.18));
    }
    .leaf-card strong{
      display:block;
      font-size: 14px;
      letter-spacing: .2px;
      color: rgba(255,255,255,.92);
      text-align:center;
    }
    .leaf-card span{
      display:block;
      margin-top: 6px;
      font-size: 13px;
      color: rgba(255,255,255,.72);
      text-align:center;
      line-height: 1.4;
    }
    .leaf-card.locked{
      opacity:.55;
      pointer-events:none;
    }
    .leaf-card.selected{
      border-color: rgba(80,255,160,.45);
      background: linear-gradient(180deg, rgba(31,107,51,.40), rgba(31,107,51,.14));
      box-shadow: 0 0 30px rgba(80,255,160,.14);
    }
    .badge{
      position:absolute;
      top: 10px;
      right: 10px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.18);
      color: rgba(255,255,255,.88);
      font-weight: 900;
      font-size: 12px;
      letter-spacing:.4px;
      backdrop-filter: blur(8px);
    }

    /* Reveal output */
    .reveal{
      margin-top: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.35);
      padding: 14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      display:none;
    }
    .reveal h3{
      margin: 0 0 8px;
      color: rgba(80,255,160,.95);
      letter-spacing:.2px;
    }
    .reveal p{
      margin:0;
      color: rgba(255,255,255,.84);
      line-height: 1.5;
    }
    .reveal .fine{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,255,255,.62);
    }

    /* ===== Step 3: Spin ===== */
    .spin-wrap{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 14px;
      align-items: center;
      margin-top: 12px;
    }
    @media (max-width: 900px){ .spin-wrap{ grid-template-columns: 1fr; } }

    .wheel-shell{
      width: 320px;
      max-width: 92vw;
      margin: 0 auto;
      position: relative;
    }
    .pointer{
      position:absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 18px solid rgba(80,255,160,.92);
      filter: drop-shadow(0 0 10px rgba(80,255,160,.25));
      z-index: 3;
    }
    .wheel{
      width: 320px;
      height: 320px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background:
        conic-gradient(
          rgba(31,107,51,.62) 0deg 60deg,
          rgba(255,255,255,.07) 60deg 120deg,
          rgba(31,107,51,.35) 120deg 180deg,
          rgba(255,255,255,.07) 180deg 240deg,
          rgba(31,107,51,.50) 240deg 300deg,
          rgba(255,255,255,.07) 300deg 360deg
        );
      box-shadow:
        0 18px 50px rgba(0,0,0,.60),
        0 0 34px rgba(80,255,160,.12);
      position: relative;
      overflow:hidden;
      transform: rotate(0deg);
      transition: transform 3.2s cubic-bezier(.2,.9,.15,1);
    }
    .wheel::after{
      content:"BONUS";
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      font-weight: 1000;
      letter-spacing: 1px;
      color: rgba(255,255,255,.82);
      text-shadow: 0 0 18px rgba(0,0,0,.55);
      font-size: 18px;
    }

    .spin-side h3{
      margin: 0 0 8px;
      color: rgba(80,255,160,.95);
    }
    .spin-result{
      margin-top: 10px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.88);
      font-weight: 900;
      display:none;
    }
    .spin-fine{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,255,255,.62);
    }

    /* ===== Popup form ===== */
    .popup{
      display:none;
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: rgba(0,0,0,.72);
      justify-content:center;
      align-items:center;
      padding: 18px 12px;
    }
    .popup-content{
      width: 100%;
      max-width: 440px;
      border-radius: 16px;
      background: rgba(10,10,10,.96);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow:
        0 26px 70px rgba(0,0,0,.70),
        0 0 30px rgba(80,255,160,.12);
      padding: 18px 16px 16px;
      position: relative;
      color: var(--text);
    }
    .popup-content h2{
      margin: 4px 0 12px;
      text-align:center;
      font-size: 1.15rem;
      color: rgba(80,255,160,.95);
    }
    .popup-content .close{
      position:absolute;
      top: 8px;
      right: 10px;
      border:none;
      background: transparent;
      color:#fff;
      font-size: 34px;
      font-weight: 900;
      cursor:pointer;
      line-height:1;
    }
    .field{ margin: 10px 0; }
    label{
      display:block;
      margin: 0 0 6px;
      font-weight: 900;
      color: rgba(255,255,255,.82);
      font-size: .92rem;
    }
    input, textarea{
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      padding: 10px 12px;
      outline: none;
    }
    textarea{ resize: vertical; }
    #estimate-send{
      width:100%;
      margin-top: 12px;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.92);
      color: #0f5f33;
      padding: 12px 14px;
      font-weight: 900;
      cursor: pointer;
    }
    #estimate-send:hover{ filter: brightness(1.03); }

    .portal-footer{
      margin-top: 18px;
      text-align:center;
      color: rgba(255,255,255,.65);
      font-size: 12px;
      padding-top: 14px;
    }
  </style>
</head>

<body>
  <div class="portal-bg"></div>
  <div class="grain"></div>

  <div class="wrap">

    <!-- Top bar (portal-style nav, no global.html) -->
    <div class="topbar">
      <div class="leaf-brand">
        <div class="leaf-logo">
          <!-- ✅ Experience logo: use spray gun by default (swap to Valentine file whenever) -->
          <img src="56AA0400-CB8D-453A-8AA5-7B4DAC1DB949.png" alt="New Leaf Mascot">
          <!-- Holiday swap example:
          <img src="FD7AB547-3907-41B6-9529-9560297A038C.png" alt="New Leaf Mascot Holiday">
          -->
        </div>
        <div class="leaf-title">
          <strong>New Leaf Painting Co.</strong>
          <span>The Experience Portal</span>
        </div>
      </div>

      <div class="top-actions">
        <a class="nl-btn ghost" href="index.html">Home</a>
        <a class="nl-btn" href="past-projects.html">Past Projects</a>
        <a class="nl-btn primary" href="#" data-contact-open="1">Get Free Estimate</a>
      </div>
    </div>

    <!-- Hero -->
    <section class="hero">
      <h1>Welcome to The Experience</h1>
      <p>
        This isn’t a boring painting website. It’s a preview of what it feels like when your home gets a <i>new leaf</i> —
        cleaner lines, brighter rooms, and work done the right way.
      </p>

      <div class="type-line" aria-label="Portal message">
        <span id="typeText"></span><span class="cursor"></span>
      </div>
    </section>

    <!-- STEP 1 -->
    <section class="card" id="step1">
      <h2>Step 1: What are you looking to paint?</h2>
      <p>Select all that apply. This helps the portal load deals that actually match what you need.</p>

      <div class="chips" role="group" aria-label="Service selections">
        <div class="chip" data-svc="walls">Walls</div>
        <div class="chip" data-svc="ceilings">Ceilings</div>
        <div class="chip" data-svc="trim">Trim / Doors</div>
        <div class="chip" data-svc="cabinets">Kitchen Cabinets</div>
        <div class="chip" data-svc="exterior">Exterior</div>
        <div class="chip" data-svc="not_sure">Not sure yet</div>
      </div>

      <div class="mini-note">✅ After selecting, scroll to Step 2 and pick ONE leaf to reveal your deal.</div>
    </section>

    <!-- STEP 2 -->
    <section class="card" id="step2">
      <h2>Step 2: Pick ONE Leaf</h2>
      <p>You get one reveal. Choose wisely.</p>

      <div class="pick-grid" aria-label="Pick one leaf to reveal">
        <div class="leaf-card" data-leaf="chest">
          <div class="badge">Pick me</div>
          <img src="60D479FE-6981-4386-AA4A-189873CE108B.png" alt="Leaf holding treasure chest">
          <strong>The Treasure Leaf</strong>
          <span>Feels like the big win… but the portal can be tricky.</span>
        </div>

        <div class="leaf-card" data-leaf="brush">
          <div class="badge">Pick me</div>
          <img src="D20E363A-FA00-4FC9-8E3F-E29E9DAB17DB.png" alt="Leaf holding brush">
          <strong>The Detail Leaf</strong>
          <span>Usually pulls the cleanest “finish-focused” perks.</span>
        </div>

        <div class="leaf-card" data-leaf="blank">
          <div class="badge">Pick me</div>
          <img src="3853F55F-F2AB-4931-BCDE-033BBDB26E1C.png" alt="Leaf with no prop">
          <strong>The Mystery Leaf</strong>
          <span>Could be a discount… could be a bonus add-on. Mystery rules.</span>
        </div>
      </div>

      <div class="reveal" id="dealReveal" aria-live="polite">
        <h3 id="dealTitle">Unlocked</h3>
        <p id="dealBody"></p>
        <div class="fine" id="dealFine"></div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
          <a class="nl-btn primary" href="#" data-contact-open="1">Use this deal → Get estimate</a>
          <button class="nl-btn" id="copyDealBtn" type="button">Copy deal text</button>
        </div>
      </div>

      <div class="mini-note" id="pickNote" style="margin-top:12px;">
        (This locks per visitor. Want it to lock per-day instead? Say the word.)
      </div>
    </section>

    <!-- STEP 3 -->
    <section class="card" id="step3">
      <h2>Step 3: Optional Daily Bonus Spin</h2>
      <p>After your deal reveal, you can try for a small bonus. One spin per day.</p>

      <div class="spin-wrap">
        <div class="wheel-shell" aria-label="Bonus spin wheel">
          <div class="pointer" aria-hidden="true"></div>
          <div class="wheel" id="wheel"></div>
        </div>

        <div class="spin-side">
          <h3>Spin for a small bonus</h3>
          <p style="margin:0; color: rgba(255,255,255,.78); line-height:1.5;">
            These are meant to be little “nice extras,” not massive giveaways.
          </p>

          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
            <button class="nl-btn primary" id="spinBtn" type="button">Spin now</button>
            <button class="nl-btn" id="resetDemoBtn" type="button" title="Demo only (delete later)">Demo reset</button>
          </div>

          <div class="spin-result" id="spinResult"></div>
          <div class="spin-fine" id="spinFine">
            (Tip: This keeps people on the page longer = “wow this is different” energy.)
          </div>
        </div>
      </div>
    </section>

    <div class="portal-footer">
      Powered by New Leaf Painting Co. • Southern Maine • “Different on purpose.”
    </div>

  </div>

  <!-- Estimate Popup (standalone for this page) -->
  <div id="contact-popup" class="popup" aria-modal="true" role="dialog" aria-label="Get free estimate popup">
    <div class="popup-content">
      <button type="button" class="close" aria-label="Close">&times;</button>
      <h2>Get free estimate</h2>

      <form id="estimate-form" novalidate>
        <div class="field">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" placeholder="Your name">
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" placeholder="you@email.com">
        </div>

        <div class="field">
          <label for="phone">Phone</label>
          <input type="tel" id="phone" name="phone" placeholder="(207) 555-1234">
        </div>

        <div class="field">
          <label for="message">Message</label>
          <textarea id="message" name="message" rows="4" placeholder="Tell me what you’re looking to paint…"></textarea>
        </div>

        <button id="estimate-send" type="button">Send</button>
      </form>
    </div>
  </div>

  <script>
    // =========================
    // Helpers
    // =========================
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const todayKey = () => new Date().toISOString().slice(0,10); // YYYY-MM-DD

    // =========================
    // 1) Slower portal typing (readable)
    // =========================
    (function(){
      const lines = [
        "Portal scan complete… ✅",
        "You have entered: The New Leaf Experience.",
        "Pick what you want painted… then pick ONE leaf.",
        "Then try your daily bonus spin (optional).",
        "If you ever need painting… you’ll remember this."
      ];

      const el = $("#typeText");
      let i=0, j=0, deleting=false;

      // ✅ slower + longer pauses so people can read
      const TYPE_SPEED = 55;     // was ~34
      const DELETE_SPEED = 20;   // was ~22
      const END_PAUSE = 1400;    // pause at end of line
      const BETWEEN_PAUSE = 450; // pause between delete->next

      function tick(){
        const target = lines[i];

        if(!deleting){
          el.textContent = target.slice(0, j++);
          if(j > target.length){
            // pause on full line
            setTimeout(() => { deleting = true; tick(); }, END_PAUSE);
            return;
          }
          setTimeout(tick, TYPE_SPEED);
        } else {
          el.textContent = target.slice(0, j--);
          if(j <= 0){
            deleting = false;
            i = (i+1) % lines.length;
            j = 0;
            setTimeout(tick, BETWEEN_PAUSE);
            return;
          }
          setTimeout(tick, DELETE_SPEED);
        }
      }
      tick();
    })();

    // =========================
    // 2) Step 1: selections
    // =========================
    const selected = new Set();

    $$(".chip").forEach(chip => {
      chip.addEventListener("click", () => {
        const k = chip.dataset.svc;
        if (selected.has(k)) { selected.delete(k); chip.classList.remove("active"); }
        else { selected.add(k); chip.classList.add("active"); }
      });
    });

    function selectedList(){
      if (selected.size === 0) return ["not_sure"];
      return Array.from(selected);
    }

    // =========================
    // 3) Step 2: Pick one leaf -> deals
    // =========================
    const PICK_LOCK_KEY = "nl_exp_leaf_pick_lock"; // lock forever (per device)
    const PICK_VALUE_KEY = "nl_exp_leaf_pick_value"; // stored deal text

    // Deal library (edit these anytime)
    const deals = {
      walls: [
        {title:"Room Bundle Boost", body:"Get an extra $150 off when you paint 2+ rooms (walls + ceilings)."},
        {title:"Third Room Sweetener", body:"Book 2 rooms and get a small 3rd room discounted (walls only)."}
      ],
      ceilings: [
        {title:"Ceiling Clean-Up", body:"$100 off any ceiling repaint when bundled with walls in the same room."}
      ],
      trim: [
        {title:"Trim Upgrade", body:"$125 off trim/door repaint when bundled with a full room repaint."}
      ],
      cabinets: [
        {title:"Cabinet Refresh Credit", body:"$250 off a full cabinet respray when you book before/after photos for the portfolio."},
        {title:"Cabinet Hardware Bonus", body:"Free basic hardware swap labor (you provide hardware) with a cabinet respray."}
      ],
      exterior: [
        {title:"Exterior Prep Credit", body:"$200 off an exterior repaint when booked with full prep included."}
      ],
      not_sure: [
        {title:"Mystery Estimate Perk", body:"Mention “EXPERIENCE” and I’ll add a little bonus into your quote if we’re a fit."}
      ]
    };

    // Leaf flavor bias (optional)
    // You can steer each leaf toward a deal type.
    const leafBias = {
      chest: ["not_sure","walls","cabinets","trim"],
      brush: ["trim","walls","ceilings"],
      blank: ["not_sure","walls","cabinets","exterior","trim","ceilings"]
    };

    function pickDeal(leafId){
      // 1) gather user selections
      const picks = selectedList();

      // 2) build weighted pool: selected items get priority; leaf bias adds some personality
      let pool = [];

      // strong weight for what they selected
      picks.forEach(k => {
        (deals[k] || deals.not_sure).forEach(d => pool.push({k, ...d, w: 3}));
      });

      // small weight from leaf personality
      (leafBias[leafId] || ["not_sure"]).forEach(k => {
        (deals[k] || deals.not_sure).forEach(d => pool.push({k, ...d, w: 1}));
      });

      // fallback safety
      if (pool.length === 0) pool = deals.not_sure.map(d => ({k:"not_sure", ...d, w:1}));

      // Weighted random pick
      const total = pool.reduce((s,x)=>s + x.w, 0);
      let r = Math.random() * total;
      for (const item of pool){
        r -= item.w;
        if (r <= 0) return item;
      }
      return pool[0];
    }

    function lockPickUI(selectedCard){
      $$(".leaf-card").forEach(card => {
        card.classList.add("locked");
        card.querySelector(".badge").textContent = "Locked";
      });
      selectedCard.classList.remove("locked");
      selectedCard.classList.add("selected");
      selectedCard.querySelector(".badge").textContent = "Selected";
    }

    function showDeal(dealObj){
      const reveal = $("#dealReveal");
      $("#dealTitle").textContent = "Unlocked Deal: " + dealObj.title;
      $("#dealBody").textContent = dealObj.body;

      const fine = $("#dealFine");
      fine.textContent =
        "Fine print: Applies to qualifying projects. Not stackable with other promos. Valid for a limited time. " +
        "Mention “EXPERIENCE” when you request an estimate.";

      reveal.style.display = "block";

      // Save a clean copy string for the clipboard + email helper
      const txt =
        `Unlocked Deal: ${dealObj.title}\n\n${dealObj.body}\n\nMention “EXPERIENCE” in your estimate request.`;
      localStorage.setItem(PICK_VALUE_KEY, txt);
    }

    function restorePickIfAny(){
      const locked = localStorage.getItem(PICK_LOCK_KEY);
      const savedDeal = localStorage.getItem(PICK_VALUE_KEY);

      if (locked && savedDeal){
        // lock cards
        const chosen = $(`.leaf-card[data-leaf="${locked}"]`);
        if (chosen) lockPickUI(chosen);

        // show stored deal
        $("#dealReveal").style.display = "block";
        $("#dealTitle").textContent = "Unlocked Deal (Saved)";
        $("#dealBody").textContent = savedDeal.replace(/^Unlocked Deal:\s*/,"");
        $("#dealFine").textContent =
          "Saved on this device. Want it to reset daily instead? Tell Mike (Phillip) and we’ll flip the switch.";
      }
    }

    $$(".leaf-card").forEach(card => {
      card.addEventListener("click", () => {
        // already locked?
        if (localStorage.getItem(PICK_LOCK_KEY)) return;

        const leafId = card.dataset.leaf;
        const dealObj = pickDeal(leafId);

        // Lock + reveal
        lockPickUI(card);
        showDeal(dealObj);

        // Persist lock
        localStorage.setItem(PICK_LOCK_KEY, leafId);
      });
    });

    $("#copyDealBtn").addEventListener("click", async () => {
      const txt = localStorage.getItem(PICK_VALUE_KEY) || "";
      if (!txt) return alert("No deal to copy yet — pick a leaf first.");
      try{
        await navigator.clipboard.writeText(txt);
        alert("Copied ✅ Paste it into your estimate message if you want.");
      } catch {
        alert("Copy didn’t work on this browser. You can screenshot the deal instead.");
      }
    });

    restorePickIfAny();

    // =========================
    // 4) Step 3: Daily spin (once per day)
    // =========================
    const SPIN_KEY = "nl_exp_spin_date";
    const SPIN_RESULT_KEY = "nl_exp_spin_result";

    const wheel = $("#wheel");
    const spinBtn = $("#spinBtn");
    const spinResult = $("#spinResult");

    // Weighted bonuses (edit anytime)
    const bonuses = [
      { label: "Bonus: $100 off", weight: 18 },
      { label: "Bonus: 5% off labor", weight: 12 },
      { label: "Bonus: Paint credit (up to $75)", weight: 14 },
      { label: "Bonus: Priority scheduling", weight: 10 },
      { label: "Bonus: Free color consult (15 min)", weight: 18 },
      { label: "No bonus today (try tomorrow)", weight: 28 }
    ];

    function weightedPick(list){
      const total = list.reduce((s,x)=>s + x.weight, 0);
      let r = Math.random() * total;
      for (const item of list){
        r -= item.weight;
        if (r <= 0) return item;
      }
      return list[list.length-1];
    }

    function spinDisabledState(reasonText){
      spinBtn.classList.add("disabled");
      spinBtn.textContent = reasonText;
    }

    function restoreSpinIfAny(){
      const d = localStorage.getItem(SPIN_KEY);
      const r = localStorage.getItem(SPIN_RESULT_KEY);
      if (d === todayKey() && r){
        spinResult.style.display = "block";
        spinResult.textContent = "Today’s spin: " + r;
        spinDisabledState("Come back tomorrow");
      }
    }

    function spinNow(){
      // Require a leaf pick first (optional but feels “earned”)
      if (!localStorage.getItem(PICK_LOCK_KEY)){
        alert("Pick a leaf first to unlock the bonus spin.");
        return;
      }

      // Once per day
      if (localStorage.getItem(SPIN_KEY) === todayKey()){
        restoreSpinIfAny();
        return;
      }

      spinBtn.classList.add("disabled");
      spinBtn.textContent = "Spinning…";

      // Visual spin
      const spins = 5 + Math.random() * 3;  // 5–8 rotations
      const endDeg = Math.floor(360 * spins);
      wheel.style.transform = `rotate(${endDeg}deg)`;

      // Decide result
      const result = weightedPick(bonuses).label;

      setTimeout(() => {
        spinResult.style.display = "block";
        spinResult.textContent = result;

        localStorage.setItem(SPIN_KEY, todayKey());
        localStorage.setItem(SPIN_RESULT_KEY, result);

        spinBtn.textContent = "Come back tomorrow";
      }, 3300);
    }

    spinBtn.addEventListener("click", spinNow);

    // Demo reset button (delete later if you want)
    $("#resetDemoBtn").addEventListener("click", () => {
      localStorage.removeItem(SPIN_KEY);
      localStorage.removeItem(SPIN_RESULT_KEY);
      localStorage.removeItem(PICK_LOCK_KEY);
      localStorage.removeItem(PICK_VALUE_KEY);
      location.reload();
    });

    restoreSpinIfAny();

    // =========================
    // 5) Popup wiring (Experience page only)
    // =========================
    const popup = $("#contact-popup");
    const openers = $$('[data-contact-open="1"]');
    const closeBtn = $(".close", popup);

    const openPopup = (e) => { if(e) e.preventDefault(); popup.style.display="flex"; };
    const closePopup = () => popup.style.display="none";

    openers.forEach(o => o.addEventListener("click", openPopup));
    closeBtn.addEventListener("click", closePopup);
    window.addEventListener("click", (e)=>{ if(e.target === popup) closePopup(); });
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closePopup(); });

    // =========================
    // 6) Send button wiring (mailto with info + deal)
    // =========================
    $("#estimate-send").addEventListener("click", ()=>{
      const name = ($("#name").value || "").trim();
      const email = ($("#email").value || "").trim();
      const phone = ($("#phone").value || "").trim();
      const message = ($("#message").value || "").trim();

      if (!name || (!email && !phone)) {
        alert("Please enter your name and either an email or phone number.");
        return;
      }

      const dealTxt = localStorage.getItem(PICK_VALUE_KEY) || "";
      const spinTxt = localStorage.getItem(SPIN_RESULT_KEY) || "";

      const to = "newleafpaintingcompany@gmail.com";
      const subject = encodeURIComponent(`Estimate Request - ${name}${phone ? " - " + phone : ""}`);

      const body = encodeURIComponent(
`Hi Mike,

I'd like a free estimate. Here’s my info:

Name: ${name}
Email: ${email || "(not provided)"}
Phone: ${phone || "(not provided)"}

What I’m looking to paint:
${selectedList().join(", ")}

${dealTxt ? ("---\n" + dealTxt + "\n") : ""}${spinTxt ? ("\nDaily Bonus Spin: " + spinTxt + "\n") : ""}

Message:
${message || "(no message)"}

Thanks!`
      );

      window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
      closePopup();
    });
  </script>
</body>
</html>
