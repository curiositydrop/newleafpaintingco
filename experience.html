<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Experience | New Leaf Painting Co.</title>
  <meta name="description" content="A fun, interactive portal into the New Leaf Painting experience. Pick a Leaf, win a deal, and take a bonus spin." />

  <style>
    :root{
      --bg:#000;
      --panel: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --green:#1f6b33;
      --glow: rgba(80,255,160,.26);
    }

    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; background:var(--bg); color:var(--text); overflow-x:hidden; }
    a{ color:inherit; text-decoration:none; }

    /* Ambient portal background (stable) */
    .portal-bg{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(900px 420px at 50% 0%, rgba(80,255,160,.14), transparent 60%),
        radial-gradient(700px 420px at 15% 30%, rgba(31,107,51,.16), transparent 65%),
        radial-gradient(700px 420px at 85% 35%, rgba(80,255,160,.10), transparent 60%),
        #000;
    }
    .grain{
      position:fixed; inset:0; z-index:-1; pointer-events:none;
      opacity:.08;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    .wrap{ max-width: 1080px; margin:0 auto; padding: 18px 14px 80px; }

    /* Topbar */
    .topbar{
      display:flex; justify-content:space-between; align-items:center;
      gap:12px; padding: 10px 0 16px; flex-wrap:wrap;
    }

    .leaf-brand{ display:flex; align-items:center; gap:10px; min-width:0; }
    .leaf-logo{
      width:140px; height:140px; border-radius:14px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 0 22px rgba(80,255,160,.18);
      display:grid; place-items:center; overflow:hidden;
      flex:0 0 auto;
      touch action: manipulation;
      cursor:pointer;
    }
    .leaf-logo img{ width:140%; height:140%; object-fit:contain; display:block; filter: drop-shadow(0 0 12px rgba(80,255,160,.25)); }

    .leaf-title{ display:flex; flex-direction:column; line-height:1.1; min-width:0; }
    .leaf-title strong{ font-size:24px; font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .leaf-title span{ font-size:18px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .top-actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }

    /* Buttons */
    .nl-btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      letter-spacing:.2px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .nl-btn:hover{ transform: translateY(-1px); filter: brightness(1.06); background: rgba(255,255,255,.09); }
    .nl-btn.primary{
      border-color: rgba(80,255,160,.28);
      background: linear-gradient(180deg, rgba(31,107,51,.42), rgba(31,107,51,.18));
      box-shadow: 0 0 22px rgba(80,255,160,.14);
    }
    .nl-btn.ghost{ background: transparent; border-color: rgba(255,255,255,.18); }

    /* Hero */
    .hero{
      margin-top: 6px;
      padding: 18px 16px 16px;
      border-radius: 18px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 18px 50px rgba(0,0,0,.55), 0 0 34px rgba(80,255,160,.12);
      position:relative;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:-60px -40px auto -40px;
      height: 220px;
      background: radial-gradient(closest-side, rgba(80,255,160,.18), transparent 70%);
      filter: blur(10px);
      opacity:.85;
    }
    .hero h1{
      margin:0 0 8px;
      font-size: clamp(1.55rem, 3.1vw, 2.25rem);
      color: rgba(80,255,160,.95);
      text-shadow: 0 0 14px rgba(80,255,160,.18);
      position:relative;
    }
    .hero p{ margin:0; color: rgba(255,255,255,.84); line-height:1.5; position:relative; max-width: 860px; }

    /* Typing box (stable height so page doesn‚Äôt jump) */
    .type-line{
      margin-top: 12px;
      background: rgba(0,0,0,.38);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 12px 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size: 13px;
      color: rgba(255,255,255,.82);
      position:relative;
      min-height: 48px; /* prevents twitch */
      display:flex;
      align-items:center;
    }
    .cursor{
      display:inline-block;
      width: 10px; height: 16px;
      background: rgba(80,255,160,.9);
      margin-left: 6px;
      border-radius: 2px;
      animation: blink .9s steps(1) infinite;
      flex:0 0 auto;
    }
    @keyframes blink{ 50%{ opacity:0; } }

    /* Sections */
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 14px;
    }
    .card{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 12px 28px rgba(0,0,0,.45);
    }
    .card h2{
      margin:0 0 10px;
      color: rgba(80,255,160,.92);
      letter-spacing:.2px;
      font-size: 1.15rem;
    }
    .card p{ margin: 0 0 12px; color: rgba(255,255,255,.78); line-height:1.5; }

    /* Pick a leaf */
    .leaf-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width: 860px){ .leaf-grid{ grid-template-columns: 1fr; } }

    .leaf-card{
      border-radius: 18px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.14);
      padding: 14px;
      text-align:center;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, border-color .12s ease;
      user-select:none;
      position:relative;
      overflow:hidden;
      min-height:320px;
    }
    .leaf-card:hover{ transform: translateY(-2px); filter: brightness(1.06); border-color: rgba(80,255,160,.35); }
    .leaf-card.disabled{ opacity:.55; cursor:not-allowed; filter:none; transform:none; }
    .leaf-card.selected{ border-color: rgba(80,255,160,.55); box-shadow: 0 0 22px rgba(80,255,160,.10); }

    .leaf-card img{
      width: 290px;
      height: 290px;
      object-fit: contain;
      display:block;
      margin: 0 auto 8px;
      filter: drop-shadow(0 0 14px rgba(80,255,160,.16));
    }
    .leaf-card strong{ display:block; font-weight: 950; letter-spacing:.2px; }
    .leaf-card small{ display:block; margin-top: 4px; color: rgba(255,255,255,.70); }

    .status-row{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,.10);
    }
    .status-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.82);
      font-weight: 850;
      font-size: 12px;
    }
    .status-pill b{ color: rgba(80,255,160,.95); }

    /* Bonus spin */
    .spin-wrap{
      display:grid;
      grid-template-columns: 300px 1fr;
      gap: 14px;
      align-items:center;
    }
    @media (max-width: 860px){ .spin-wrap{ grid-template-columns: 1fr; } }

    .wheel-area{
      display:grid;
      place-items:center;
      gap: 10px;
    }
    .wheel{
      width: 260px;
      height: 260px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background:
        conic-gradient(
          rgba(31,107,51,.85) 0 60deg,
          rgba(255,255,255,.10) 60deg 120deg,
          rgba(31,107,51,.72) 120deg 180deg,
          rgba(255,255,255,.12) 180deg 240deg,
          rgba(31,107,51,.78) 240deg 300deg,
          rgba(255,255,255,.10) 300deg 360deg
        );
      box-shadow: 0 18px 50px rgba(0,0,0,.55), 0 0 30px rgba(80,255,160,.10);
      position:relative;
      transform: rotate(0deg);
      transition: transform 2.6s cubic-bezier(.2,.9,.1,1);
      will-change: transform;
    }
    .wheel::after{
      content:"";
      position:absolute;
      inset: 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      /* backdrop-filter: blur(6px); */ /* (fixed: CSS comment style) */
    }
    .wheel-labels{
      position:absolute;
      inset:0;
      display:block;
      pointer-events:none;
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.2px;
      color: rgba(255,255,255,.90);
    }
    .wheel-labels span{
      position:absolute;
      left: 50%;
      top: 50%;
      transform-origin: 0 0;
      white-space:nowrap;
      text-shadow: 0 0 10px rgba(0,0,0,.65);
    }

    /* pointer */
    .pointer{
      width: 0; height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 16px solid rgba(80,255,160,.95);
      filter: drop-shadow(0 0 10px rgba(80,255,160,.25));
      margin-bottom: -6px;
    }

    .spin-note{
      color: rgba(255,255,255,.74);
      line-height:1.5;
    }

    .locked{
      opacity:.6;
      pointer-events:none;
      filter: grayscale(.1);
    }

    /* Ask the Leaf (simple, clean) */
    .qa{
      display:grid;
      gap: 10px;
      margin-top: 10px;
    }
    .qa button{
      width:100%;
      text-align:left;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.90);
      font-weight: 900;
      cursor:pointer;
    }
    .qa button:hover{ filter: brightness(1.05); }
    .answer{
      display:none;
      padding: 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.80);
      line-height:1.5;
    }
    .answer.show{ display:block; }

    /* ‚úÖ NEW: Ask-the-Leaf header row w/ small mascot */
    .ask-leaf-head{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:10px;
    }
    .ask-leaf-head img{
      width:96px;
      height:auto;
      opacity:.9;
      filter: drop-shadow(0 0 10px rgba(80,255,160,.18));
      flex:0 0 auto;
    }

    /* Modal */
    .modal{
      display:none;
      position:fixed;
      inset:0;
      z-index: 9999;
      background: rgba(0,0,0,.78);
      padding: 18px 12px;
      align-items:center;
      justify-content:center;
    }
    .modal-box{
      width:100%;
      max-width: 520px;
      border-radius: 18px;
      background: rgba(10,10,10,.97);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 26px 70px rgba(0,0,0,.70), 0 0 30px rgba(80,255,160,.12);
      padding: 16px 14px 14px;
      position:relative;
      overflow:hidden;
    }
    .modal-box::before{
      content:"";
      position:absolute;
      inset:-60px -60px auto -60px;
      height: 220px;
      background: radial-gradient(closest-side, rgba(80,255,160,.14), transparent 70%);
      filter: blur(12px);
      opacity:.9;
    }
    .modal-close{
      position:absolute;
      top: 8px;
      right: 10px;
      border:none;
      background: transparent;
      color:#fff;
      font-size: 34px;
      font-weight: 900;
      cursor:pointer;
      line-height:1;
      z-index:2;
    }
    .modal-box h3{
      margin: 4px 0 8px;
      color: rgba(80,255,160,.95);
      text-shadow: 0 0 14px rgba(80,255,160,.14);
      position:relative;
      z-index:2;
    }
    .modal-box p{
      margin: 0 0 12px;
      color: rgba(255,255,255,.84);
      line-height:1.5;
      position:relative;
      z-index:2;
    }
    .win-pill{
      display:inline-flex;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      font-weight: 950;
      color: rgba(255,255,255,.92);
      position:relative;
      z-index:2;
      margin-bottom: 12px;
    }
    .win-pill b{ color: rgba(80,255,160,.95); }

    /* Popup estimate form (portal page only) */
    .popup{
      display:none;
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: rgba(0,0,0,.72);
      justify-content:center;
      align-items:center;
      padding: 18px 12px;
    }
    .popup-content{
      width: 100%;
      max-width: 440px;
      border-radius: 16px;
      background: rgba(10,10,10,.96);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 26px 70px rgba(0,0,0,.70), 0 0 30px rgba(80,255,160,.12);
      padding: 18px 16px 16px;
      position: relative;
      color: var(--text);
    }
    .popup-content h2{
      margin: 4px 0 12px;
      text-align:center;
      font-size: 1.15rem;
      color: rgba(80,255,160,.95);
    }
    .popup-content .close{
      position:absolute;
      top: 8px;
      right: 10px;
      border:none;
      background: transparent;
      color:#fff;
      font-size: 34px;
      font-weight: 900;
      cursor:pointer;
      line-height:1;
    }
    .field{ margin: 10px 0; }
    label{
      display:block;
      margin: 0 0 6px;
      font-weight: 900;
      color: rgba(255,255,255,.82);
      font-size: .92rem;
    }
    input, textarea{
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      padding: 10px 12px;
      outline: none;
    }
    textarea{ resize: vertical; }
    #estimate-send{
      width:100%;
      margin-top: 12px;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.92);
      color: #0f5f33;
      padding: 12px 14px;
      font-weight: 900;
      cursor: pointer;
    }
    #estimate-send:hover{ filter: brightness(1.03); }

    .portal-footer{
      margin-top: 18px;
      text-align:center;
      color: rgba(255,255,255,.65);
      font-size: 12px;
      padding-top: 14px;
    }
  </style>
</head>

<body>
  <div class="portal-bg"></div>
  <div class="grain"></div>

  <div class="wrap">
    <!-- Top bar -->
    <div class="topbar">
      <div class="leaf-brand">
        <div class="leaf-logo">
          <!-- Experience logo: holiday / special vibe -->
          <img src="FD7AB547-3907-41B6-9529-9560297A038C.png" alt="New Leaf Mascot">
        </div>
        <div class="leaf-title">
          <strong>New Leaf Painting Co.</strong>
          <span>The Experience Portal</span>
        </div>
      </div>

      <div class="top-actions">
        <a class="nl-btn ghost" href="xp-home.html">Home</a>
        <a class="nl-btn" href="past-projects.html">Past Projects</a>
        <a class="nl-btn primary" href="#" data-contact-open="1">Get Free Estimate</a>
      </div>
    </div>

    <!-- Hero -->
    <section class="hero">
      <h1>Welcome to The Experience</h1>
      <p>
        At New Leaf Painting, we make boring‚Ä¶ fun.
You just found a quality, local painter who does things different ‚Äî on purpose.
Pick a Leaf, win something, then try your bonus spin.
Serving Southern Maine
      </p>

      <div class="type-line" aria-label="Portal message">
        <span id="typeText"></span><span class="cursor"></span>
      </div>
    </section>

    <div class="grid">

      <!-- PICK A LEAF -->
      <section class="card">
        <h2>Pick a Leaf</h2>
        <p><b>One pick per project address, must schedule estimate within 14 days of winning.</b> Choose wisely‚Ä¶ then we‚Äôll unlock a bonus spin.</p>

        <div class="leaf-grid" id="leafGrid">
          <div class="leaf-card" data-leaf="Chest Leaf" data-img="60D479FE-6981-4386-AA4A-189873CE108B.png">
            <img src="60D479FE-6981-4386-AA4A-189873CE108B.png" alt="Leaf holding treasure chest">
            <strong>Chest Leaf</strong>
            <small>This one looks expensive‚Ä¶ üëÄ but he loves a good plot twist.</small>
          </div>

          <div class="leaf-card" data-leaf="Roller Leaf" data-img="0C935B1F-E633-43E1-A472-29A628845FB3.png">
            <img src="0C935B1F-E633-43E1-A472-29A628845FB3.png" alt="Leaf holding paint roller">
            <strong>Roller Leaf</strong>
            <small>This one feels safe... But safe isnt always lucky.</small>
          </div>

          <div class="leaf-card" data-leaf="Brush Leaf" data-img="D20E363A-FA00-4FC9-8E3F-E29E9DAB17DB.png">
            <img src="D20E363A-FA00-4FC9-8E3F-E29E9DAB17DB.png" alt="Leaf holding paint brush">
            <strong>Brush Leaf</strong>
            <small>This one is creative... bit you never know wuat you'll get.</small>
          </div>
        </div>

        <div class="status-row">
          <div class="status-pill">Leaf pick: <b id="leafStatus">Not chosen</b></div>
          <button class="nl-btn primary" id="claimBtn" disabled>Claim your win</button>
        </div>
      </section>

      <!-- BONUS SPIN -->
      <section class="card" id="spinCard">
        <h2>Bonus Spin</h2>
        <p class="spin-note">
          After you pick a Leaf, you get <b>one</b> bonus spin for a small extra perk.
          You won‚Äôt always hit ‚Äî that‚Äôs the fun.
        </p>

        <div class="spin-wrap">
          <div class="wheel-area">
            <div class="pointer" aria-hidden="true"></div>
            <div class="wheel locked" id="wheel">
              <!-- <div class="wheel-labels" aria-hidden="true" id="wheelLabels"></div> -->
            </div>
            <button class="nl-btn primary" id="spinBtn" disabled>Spin (1 try)</button>
          </div>

          <div>
            <div class="status-pill">Spin result: <b id="spinStatus">Not spun</b></div>
            <p style="margin-top:10px; color: rgba(255,255,255,.76);">
              Tip: If you claim your win, your email will automatically include what you won from
              <b>Pick a Leaf</b> and your <b>Bonus Spin</b>.
            </p>
          </div>
        </div>
      </section>

      <!-- ASK THE LEAF -->
      <section class="card">
        <!-- ‚úÖ UPDATED: mascot left of the title -->
        <div class="ask-leaf-head">
          <!-- CHANGE THIS IMAGE SRC to your no-prop leaf file name -->
          <img src="3853F55F-F2AB-4931-BCDE-033BBDB26E1C.png" alt="Ask the Leaf">
          <h2 style="margin:0;">Ask the Leaf</h2>
        </div>
        <p>Quick answers (without the salesy vibes). Tap one:</p>

        <div class="qa">
          <button type="button" data-a="a1">How do I know you‚Äôre not ‚Äúone of those painters‚Äù?</button>
          <div class="answer" id="a1">Fair question. The difference is prep + protection + cleanup. We mask properly, protect floors, cut clean lines, and leave the place looking better than we found it.</div>

          <button type="button" data-a="a2">Do you always do two coats?</button>
          <div class="answer" id="a2">Yes ‚Äî two coats is standard. If coverage needs more, we don‚Äôt play games. The goal is a finished look, not a rushed look.</div>

          <button type="button" data-a="a3">Cabinets‚Ä¶ can you really make them look factory?</button>
          <div class="answer" id="a3">That‚Äôs the goal. Proper cleaning/degreasing, sanding, correct primer, and the right topcoat + spray technique makes all the difference.</div>
        </div>
      </section>

    </div>

    <div class="portal-footer">
      Powered by New Leaf Painting Co. ‚Ä¢ Southern Maine ‚Ä¢ ‚ÄúDifferent on purpose.‚Äù
    </div>
  </div>

  <!-- WIN MODAL (reused for leaf + spin) -->
  <div id="winModal" class="modal" role="dialog" aria-modal="true" aria-label="Win modal">
    <div class="modal-box">
      <button class="modal-close" type="button" aria-label="Close">&times;</button>
      <h3 id="winTitle">You won!</h3>
      <div class="win-pill" id="winPill">Prize: <b>‚Äî</b></div>
      <p id="winText">‚Äî</p>
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
        <button class="nl-btn" id="winClose">Close</button>
        <button class="nl-btn primary" id="winNext">Next</button>
      </div>
    </div>
  </div>

  <!-- Estimate Popup -->
  <div id="contact-popup" class="popup" aria-modal="true" role="dialog" aria-label="Get free estimate popup">
    <div class="popup-content">
      <button type="button" class="close" aria-label="Close">&times;</button>
      <h2>Get free estimate</h2>

      <form id="estimate-form" novalidate>
        <div class="field">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" placeholder="Your name">
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" placeholder="you@email.com">
        </div>

        <div class="field">
          <label for="phone">Phone</label>
          <input type="tel" id="phone" name="phone" placeholder="(207) 555-1234">
        </div>

        <div class="field">
          <label for="message">Message</label>
          <textarea id="message" name="message" rows="4" placeholder="Tell me what you‚Äôre looking to paint‚Ä¶"></textarea>
        </div>

        <button id="estimate-send" type="button">Send</button>
      </form>
    </div>
  </div>

  <script>
    // ------------------------------
    // WHERE TO CHANGE THINGS (quick map)
    // ------------------------------
    // Leaf prizes:   const leafPrizes = [ ... ]
    // Spin prizes:   const spinPrizes = [ ... ]
    // Q&A text:      In HTML under <!-- ASK THE LEAF --> (buttons + answers)

    // ------------------------------
    // 1) Calm typing line (no delete-loop twitch)
    // ------------------------------
    (function(){
      const lines = [
        "Portal scan complete‚Ä¶ ‚úÖ",
        "Welcome to: The New Leaf Experience.",
        "Pick a Leaf. Win a deal. Spin for a bonus.",
        "No spam. Just a fun way to remember us."
      ];
      const el = document.getElementById("typeText");
      let lineIndex = 0;
      let charIndex = 0;

      const typeSpeed = 45;
      const holdTime  = 1400;
      const clearTime = 450;

      function typeLine(){
        const line = lines[lineIndex];
        el.textContent = line.slice(0, charIndex);
        charIndex++;

        if(charIndex <= line.length){
          setTimeout(typeLine, typeSpeed);
        } else {
          setTimeout(() => {
            el.textContent = "";
            charIndex = 0;
            lineIndex = (lineIndex + 1) % lines.length;
            setTimeout(typeLine, clearTime);
          }, holdTime);
        }
      }
      typeLine();
    })();

    // ------------------------------
    // 2) State
    // ------------------------------
    let leafWin = null;
    let leafPickName = null;
    let spinWin = null;
    let spun = false;

    // ------------------------------
    // ‚úÖ 2.5) LocalStorage lock (30 days)
    // ------------------------------
    const LS_KEY = "nl_experience_lock_v1";
    const LS_TTL_MS = 30 * 24 * 60 * 60 * 1000; // 30 days

    function nowMs(){ return Date.now(); }

    function loadLock(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return null;
        const data = JSON.parse(raw);
        if(!data || !data.createdAt) return null;

        const age = nowMs() - data.createdAt;
        if(age > LS_TTL_MS){
          localStorage.removeItem(LS_KEY);
          return null;
        }
        return data;
      } catch(e){
        try{ localStorage.removeItem(LS_KEY); }catch(_){}
        return null;
      }
    }

    function saveLock(partial){
      const current = loadLock() || { createdAt: nowMs() };
      const next = Object.assign({}, current, partial);
      if(!current.createdAt) next.createdAt = nowMs();
      localStorage.setItem(LS_KEY, JSON.stringify(next));
    }

    // ------------------------------
    // 3) Leaf pick logic + obvious win modal
    // ------------------------------
    const leafGrid = document.getElementById("leafGrid");
    const leafStatus = document.getElementById("leafStatus");
    const claimBtn = document.getElementById("claimBtn");

    // ‚úÖ WHERE TO CHANGE LEAF PRIZES:
    const leafPrizes = [
      "10% off labor (up to $300)",
      "$150 off any interior project",
      "Free color consult + sample plan",
      "Free upgrade: crisp trim touch-ups (small add-on)",
      "You found the decoy üòà ($50 off ‚Äî still a win)"
    ];

    function openWinModal({title, pill, text, nextLabel="Next", onNext=null}){
      const modal = document.getElementById("winModal");
      document.getElementById("winTitle").textContent = title;
      document.getElementById("winPill").innerHTML = pill;
      document.getElementById("winText").textContent = text;

      modal.style.display = "flex";

      const closeX = modal.querySelector(".modal-close");
      const closeBtn = document.getElementById("winClose");
      const nextBtn = document.getElementById("winNext");

      nextBtn.textContent = nextLabel;

      const close = () => { modal.style.display = "none"; cleanup(); };
      const next = () => {
        modal.style.display = "none";
        cleanup();
        if (typeof onNext === "function") onNext();
      };

      function cleanup(){
        closeX.onclick = null;
        closeBtn.onclick = null;
        nextBtn.onclick = null;
        window.removeEventListener("keydown", escClose);
        modal.onclick = null;
      }

      function escClose(e){
        if(e.key === "Escape") close();
      }

      closeX.onclick = close;
      closeBtn.onclick = close;
      nextBtn.onclick = next;

      window.addEventListener("keydown", escClose);
      modal.onclick = (e) => { if(e.target === modal) close(); };
    }

    function lockLeafPick(selectedCard, {silent=false} = {}){
      document.querySelectorAll(".leaf-card").forEach(c => {
        c.classList.add("disabled");
        c.classList.remove("selected");
      });
      selectedCard.classList.add("selected");

      leafPickName = selectedCard.getAttribute("data-leaf");
      if(!leafWin){
        leafWin = leafPrizes[Math.floor(Math.random()*leafPrizes.length)];
      }

      leafStatus.textContent = leafPickName;
      claimBtn.disabled = false;

      document.getElementById("wheel").classList.remove("locked");
      document.getElementById("spinBtn").disabled = false;

      saveLock({ leafPickName, leafWin, spun, spinWin });

      if(!silent){
        openWinModal({
          title: "‚úÖ You Won a Deal!",
          pill: `Leaf Prize: <b>${leafWin}</b>`,
          text: "Nice. Your deal is locked in. Want a chance at a small bonus too?",
          nextLabel: "Bonus Spin",
          onNext: () => {
            document.getElementById("spinCard").scrollIntoView({behavior:"smooth", block:"start"});
          }
        });
      }
    }

    leafGrid.addEventListener("click", (e) => {
      const card = e.target.closest(".leaf-card");
      if(!card) return;

      // ‚úÖ hard lock for 30 days if anything exists
      const existing = loadLock();
      if(existing && existing.leafWin) return;

      if(leafWin) return;
      lockLeafPick(card);
    });

    claimBtn.addEventListener("click", () => {
      openEstimatePopup();
      const msg = document.getElementById("message");
      const pre = [];
      if (leafWin) pre.push(`Leaf Prize: ${leafWin}`);
      if (spinWin) pre.push(`Bonus Spin: ${spinWin}`);
      if (pre.length){
        msg.value = (msg.value || "").trim();
        const add = pre.join("\n");
        if(!msg.value.includes("Leaf Prize:") && !msg.value.includes("Bonus Spin:")){
          msg.value = (msg.value ? msg.value + "\n\n" : "") + add;
        }
      }
    });

    // ------------------------------
    // 4) Bonus spin wheel
    // ------------------------------
    const spinBtn = document.getElementById("spinBtn");
    const wheel = document.getElementById("wheel");
    const spinStatus = document.getElementById("spinStatus");
    const wheelLabels = document.getElementById("wheelLabels");

    // ‚úÖ WHERE TO CHANGE SPIN PRIZES:
    const spinPrizes = [
      "+$100 off",
      "Free gallon of paint*",
      "5% off invoice",
      "Free color consult",
      "Nothing this time üòà",
      "Free upgrade: extra prep detail"
    ];

    spinBtn.addEventListener("click", () => {
      if(!leafWin) return;
      if(spun) return;

      spun = true;
      spinBtn.disabled = true;

      spinWin = spinPrizes[Math.floor(Math.random()*spinPrizes.length)];
      spinStatus.textContent = "Spinning‚Ä¶";

      // ‚úÖ store immediately so refresh can't retry
      saveLock({ leafPickName, leafWin, spun: true, spinWin });

      const extraTurns = 6;
      const stopIndex = spinPrizes.indexOf(spinWin);
      const sliceDeg = 360 / spinPrizes.length;

      const targetDeg =
        (360 - (stopIndex * sliceDeg)) +
        (extraTurns * 360) +
        (Math.random() * (sliceDeg*0.6) - (sliceDeg*0.3));

      wheel.style.transform = `rotate(${targetDeg}deg)`;

      setTimeout(() => {
        spinStatus.textContent = spinWin;
        saveLock({ leafPickName, leafWin, spun: true, spinWin });

        openWinModal({
          title: "üéâ Bonus Spin Result!",
          pill: `Bonus: <b>${spinWin}</b>`,
          text: "If you want to lock it in, hit Claim ‚Äî it will include BOTH wins in the email.",
          nextLabel: "Claim",
          onNext: () => {
            claimBtn.scrollIntoView({behavior:"smooth", block:"center"});
          }
        });
      }, 2700);
    });

    // ------------------------------
    // 5) Ask the leaf toggles
    // ------------------------------
    document.querySelectorAll(".qa button[data-a]").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-a");
        const ans = document.getElementById(id);
        ans.classList.toggle("show");
      });
    });

    // ------------------------------
    // 6) Estimate popup wiring
    // ------------------------------
    const popup = document.getElementById("contact-popup");
    const openers = document.querySelectorAll('[data-contact-open="1"]');
    const closeBtn = popup.querySelector(".close");

    function openEstimatePopup(e){
      if(e) e.preventDefault();
      popup.style.display = "flex";
    }
    function closeEstimatePopup(){ popup.style.display = "none"; }

    openers.forEach(o => o.addEventListener("click", openEstimatePopup));
    closeBtn.addEventListener("click", closeEstimatePopup);
    window.addEventListener("click", (e)=>{ if(e.target === popup) closeEstimatePopup(); });
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeEstimatePopup(); });

    // ------------------------------
    // 7) Send button -> mailto includes BOTH wins
    // ------------------------------
    const sendBtn = document.getElementById("estimate-send");
    sendBtn.addEventListener("click", ()=>{
      const name = (document.getElementById("name").value || "").trim();
      const email = (document.getElementById("email").value || "").trim();
      const phone = (document.getElementById("phone").value || "").trim();
      const message = (document.getElementById("message").value || "").trim();

      if (!name || (!email && !phone)) {
        alert("Please enter your name and either an email or phone number.");
        return;
      }

      const to = "newleafpaintingcompany@gmail.com";

      const subject = encodeURIComponent(
        `Estimate Request - ${name}${phone ? " - " + phone : ""}`
      );

      const leafLine = leafWin
        ? `Leaf Prize: ${leafWin}`
        : "Leaf Prize: (not selected)";

      const spinLine = spinWin
        ? `Bonus Spin: ${spinWin}`
        : "Bonus Spin: (not spun)";

      const body = encodeURIComponent(
`Hi Mike,

I'd like a free estimate. Here‚Äôs my info:

Name: ${name}
Email: ${email || "(not provided)"}
Phone: ${phone || "(not provided)"}

--- Experience Wins ---
${leafLine}
${spinLine}

Project details / message:
${message || "(no message)"}

Thanks!`
      );

      window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
      closeEstimatePopup();
    });

    // ------------------------------
    // ‚úÖ 8) Restore session from localStorage (30-day lock)
    // ------------------------------
    (function restoreFromLocal(){
      const data = loadLock();
      if(!data) return;

      leafWin = data.leafWin || null;
      leafPickName = data.leafPickName || null;
      spinWin = data.spinWin || null;
      spun = !!data.spun;

      if(leafWin && leafPickName){
        const cards = Array.from(document.querySelectorAll(".leaf-card"));
        const match = cards.find(c => (c.getAttribute("data-leaf") === leafPickName));
        if(match){
          lockLeafPick(match, {silent:true});
        } else {
          leafStatus.textContent = leafPickName;
          claimBtn.disabled = false;
          document.querySelectorAll(".leaf-card").forEach(c => c.classList.add("disabled"));
          document.getElementById("wheel").classList.remove("locked");
          document.getElementById("spinBtn").disabled = false;
        }
      }

      if(spun){
        spinStatus.textContent = spinWin ? spinWin : "Spun";
        spinBtn.disabled = true;
      }
    })();
    // ------------------------------
// ------------------------------
// 9) Secret 5-tap reset (logo) - iOS safe
// ------------------------------
(function(){
  const logo = document.querySelector(".leaf-logo");
  let tapCount = 0;
  let tapTimer = null;

  function registerTap(e){
    // Prevent iOS double-tap zoom from hijacking taps
    if (e) {
      e.preventDefault();
      e.stopPropagation();
    }

    tapCount++;

    if(tapCount === 1){
      tapTimer = setTimeout(() => {
        tapCount = 0;
      }, 1500); // must tap 5 times within 1.5s
    }

    if(tapCount >= 5){
      clearTimeout(tapTimer);
      tapCount = 0;

      // clear local storage lock
      clearLock();

      // hard reset state
      leafWin = null;
      leafPickName = null;
      spinWin = null;
      spun = false;

      // reset UI
      document.querySelectorAll(".leaf-card").forEach(c => {
        c.classList.remove("disabled","selected");
      });
      leafStatus.textContent = "Not chosen";
      spinStatus.textContent = "Not spun";
      claimBtn.disabled = true;
      spinBtn.disabled = true;
      wheel.classList.add("locked");
      wheel.style.transform = "rotate(0deg)";

      alert("Experience reset ‚úîÔ∏è");
    }
  }

  // iOS: touchend is the reliable one (must be passive:false to allow preventDefault)
  logo.addEventListener("touchend", registerTap, { passive: false });
  // Desktop / fallback
  logo.addEventListener("click", registerTap);
})();
  </script>
</body>
</html>
