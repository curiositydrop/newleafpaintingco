<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Experience | New Leaf Painting Co.</title>
  <meta name="description" content="A fun, interactive portal into the New Leaf Painting experience. Pick a Leaf, unlock a deal, then try a bonus spin." />

  <style>
    :root{
      --bg:#000;
      --panel: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);

      /* Your green */
      --green:#1f6b33;

      /* Glow accent */
      --glow: rgba(80,255,160,.28);

      /* Accent that can shift */
      --accent: rgba(80,255,160,.55);
    }

    *{ box-sizing: border-box; }
    html,body{ margin:0; padding:0; background:var(--bg); color:var(--text); overflow-x:hidden; }
    a{ color: inherit; text-decoration:none; }

    /* ===== Ambient portal background ===== */
    .portal-bg{
      position: fixed;
      inset: 0;
      z-index: -2;
      background:
        radial-gradient(900px 420px at 50% 0%, rgba(80,255,160,.14), transparent 60%),
        radial-gradient(700px 420px at 15% 30%, rgba(31,107,51,.16), transparent 65%),
        radial-gradient(700px 420px at 85% 35%, rgba(80,255,160,.10), transparent 60%),
        #000;
      filter: saturate(1.08);
    }
    .grain{
      position: fixed;
      inset:0;
      z-index:-1;
      pointer-events:none;
      opacity:.09;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    /* ===== Layout ===== */
    .wrap{
      max-width: 1040px;
      margin: 0 auto;
      padding: 18px 14px 70px;
    }

    /* ===== Top bar (minimal portal nav) ===== */
    .topbar{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 12px;
      padding: 10px 0 16px;
      flex-wrap: wrap;
    }

    .leaf-brand{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .leaf-logo{
      width: 54px;
      height: 54px;
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 0 22px rgba(80,255,160,.18);
      display:grid;
      place-items:center;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .leaf-logo img{
      width: 92%;
      height: 92%;
      object-fit: contain;
      display:block;
      filter: drop-shadow(0 0 12px rgba(80,255,160,.25));
    }

    .leaf-title{
      display:flex;
      flex-direction:column;
      line-height:1.15;
      min-width:0;
    }
    .leaf-title strong{
      font-size: 14px;
      letter-spacing: .2px;
      color: rgba(255,255,255,.92);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .leaf-title span{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .top-actions{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    /* ===== Buttons (match your vibe) ===== */
    .nl-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      letter-spacing: .2px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .nl-btn:hover{ transform: translateY(-1px); filter: brightness(1.06); background: rgba(255,255,255,.09); }

    .nl-btn.primary{
      border-color: rgba(80,255,160,.28);
      background: linear-gradient(180deg, rgba(31,107,51,.40), rgba(31,107,51,.18));
      box-shadow: 0 0 22px rgba(80,255,160,.16);
    }

    .nl-btn.ghost{
      background: transparent;
      border-color: rgba(255,255,255,.18);
    }

    /* ===== Portal hero ===== */
    .hero{
      margin-top: 6px;
      padding: 18px 16px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow:
        0 18px 50px rgba(0,0,0,.55),
        0 0 34px rgba(80,255,160,.12);
      overflow:hidden;
      position:relative;
    }

    .hero::before{
      content:"";
      position:absolute;
      inset:-60px -40px auto -40px;
      height: 220px;
      background: radial-gradient(closest-side, rgba(80,255,160,.20), transparent 70%);
      filter: blur(10px);
      opacity:.85;
    }

    .hero h1{
      margin: 0 0 8px;
      font-size: clamp(1.5rem, 3.2vw, 2.2rem);
      letter-spacing: .3px;
      color: rgba(80,255,160,.95);
      text-shadow: 0 0 14px rgba(80,255,160,.18);
      position:relative;
    }
    .hero p{
      margin: 0;
      max-width: 820px;
      color: rgba(255,255,255,.82);
      line-height: 1.5;
      position:relative;
    }

    .type-line{
      margin-top: 10px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: rgba(255,255,255,.80);
      font-size: 13px;
      background: rgba(0,0,0,.38);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 10px 12px;
      position:relative;
      min-height: 40px;
    }
    .cursor{
      display:inline-block;
      width: 10px;
      height: 16px;
      transform: translateY(2px);
      background: rgba(80,255,160,.9);
      margin-left: 3px;
      animation: blink .9s steps(1) infinite;
      border-radius: 2px;
    }
    @keyframes blink{ 50%{ opacity:0; } }

    /* ===== Sections ===== */
    .card{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 12px 28px rgba(0,0,0,.45);
      margin-top: 14px;
    }
    .card h2{
      margin: 0 0 10px;
      color: rgba(80,255,160,.92);
      letter-spacing: .2px;
      font-size: 1.15rem;
    }
    .card p{
      margin: 0 0 10px;
      color: rgba(255,255,255,.78);
      line-height: 1.5;
    }

    /* ===== Pick a Leaf ===== */
    .leaf-grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 10px;
    }
    @media (max-width: 900px){ .leaf-grid{ grid-template-columns: 1fr; } }

    .leaf-card{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      padding: 14px 12px 12px;
      text-align:center;
      cursor: pointer;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      user-select:none;
      position: relative;
      overflow:hidden;
    }
    .leaf-card:hover{
      transform: translateY(-1px);
      filter: brightness(1.06);
      background: rgba(255,255,255,.07);
    }
    .leaf-card img{
      width: 100%;
      max-width: 240px;
      height: 220px;         /* fixed height to prevent layout jump */
      object-fit: contain;
      display:block;
      margin: 0 auto 8px;
      filter: drop-shadow(0 0 18px rgba(80,255,160,.14));
    }
    .leaf-card strong{
      display:block;
      font-weight: 1000;
      color: rgba(255,255,255,.92);
      letter-spacing: .2px;
    }
    .leaf-card small{
      display:block;
      margin-top: 4px;
      color: rgba(255,255,255,.70);
      font-weight: 800;
    }

    .locked-note{
      margin-top: 8px;
      color: rgba(255,255,255,.72);
      font-size: 13px;
      text-align:center;
    }

    /* ===== Deal reveal box (on page) ===== */
    .deal-box{
      margin-top: 12px;
      border-radius: 16px;
      border: 1px solid rgba(80,255,160,.22);
      background: rgba(31,107,51,.12);
      padding: 12px 12px;
      display:none;
    }
    .deal-box .label{
      display:inline-flex;
      gap: 8px;
      align-items:center;
      padding: 7px 11px;
      border-radius: 999px;
      border: 1px solid rgba(80,255,160,.28);
      background: rgba(31,107,51,.20);
      font-weight: 1000;
      letter-spacing:.2px;
      color: rgba(255,255,255,.92);
    }
    .deal-box p{
      margin: 10px 0 0;
      color: rgba(255,255,255,.88);
      font-weight: 850;
    }

    /* ===== Spin Wheel ===== */
    .wheel-wrap{
      display:grid;
      gap: 10px;
      justify-items:center;
    }
    .wheel{
      width: min(360px, 86vw);
      height: min(360px, 86vw);
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        conic-gradient(
          rgba(80,255,160,.24) 0deg 60deg,
          rgba(255,255,255,.06) 60deg 120deg,
          rgba(80,255,160,.18) 120deg 180deg,
          rgba(255,255,255,.06) 180deg 240deg,
          rgba(80,255,160,.22) 240deg 300deg,
          rgba(255,255,255,.06) 300deg 360deg
        );
      box-shadow: 0 22px 60px rgba(0,0,0,.65), 0 0 30px rgba(80,255,160,.12);
      position: relative;
      transform: rotate(0deg);
      transition: transform 3.2s cubic-bezier(.12,.8,.15,1);
      will-change: transform;
    }
    .wheel::after{
      content:"";
      position:absolute;
      inset: 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
    }
    .wheel-center{
      position:absolute;
      inset: 0;
      display:grid;
      place-items:center;
      z-index: 2;
      pointer-events:none;
    }
    .wheel-center span{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 92px;
      height: 92px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.92);
      color: #0f5f33;
      font-weight: 1000;
      letter-spacing:.2px;
      box-shadow: 0 12px 30px rgba(0,0,0,.40);
    }
    .pointer{
      width:0; height:0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 18px solid rgba(80,255,160,.85);
      filter: drop-shadow(0 0 10px rgba(80,255,160,.25));
      margin-bottom: -6px;
    }
    .spin-result{
      text-align:center;
      color: rgba(255,255,255,.84);
      font-weight: 900;
      min-height: 24px;
    }

    /* ===== Popup form ===== */
    .popup{
      display:none;
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: rgba(0,0,0,.72);
      justify-content:center;
      align-items:center;
      padding: 18px 12px;
    }
    .popup-content{
      width: 100%;
      max-width: 440px;
      border-radius: 16px;
      background: rgba(10,10,10,.96);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow:
        0 26px 70px rgba(0,0,0,.70),
        0 0 30px rgba(80,255,160,.12);
      padding: 18px 16px 16px;
      position: relative;
      color: var(--text);
    }
    .popup-content h2{
      margin: 4px 0 12px;
      text-align:center;
      font-size: 1.15rem;
      color: rgba(80,255,160,.95);
    }
    .popup-content .close{
      position:absolute;
      top: 8px;
      right: 10px;
      border:none;
      background: transparent;
      color:#fff;
      font-size: 34px;
      font-weight: 900;
      cursor:pointer;
      line-height:1;
    }
    .field{ margin: 10px 0; }
    label{
      display:block;
      margin: 0 0 6px;
      font-weight: 900;
      color: rgba(255,255,255,.82);
      font-size: .92rem;
    }
    input, textarea{
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      padding: 10px 12px;
      outline: none;
    }
    textarea{ resize: vertical; }
    #estimate-send{
      width:100%;
      margin-top: 12px;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.92);
      color: #0f5f33;
      padding: 12px 14px;
      font-weight: 900;
      cursor: pointer;
    }
    #estimate-send:hover{ filter: brightness(1.03); }

    /* ===== Footer-ish ===== */
    .portal-footer{
      margin-top: 18px;
      text-align:center;
      color: rgba(255,255,255,.65);
      font-size: 12px;
      padding-top: 14px;
    }

    /* =========================
       Anti-twitch fixes
    ========================= */

    /* iPhone/touch devices: disable hover-lift jitter */
    @media (hover: none) and (pointer: coarse){
      .nl-btn:hover,
      .leaf-card:hover{
        transform: none !important;
        filter: none !important;
        background: rgba(255,255,255,.06) !important;
      }
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      *{
        animation-duration: 0.001ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.001ms !important;
        scroll-behavior: auto !important;
      }
    }

    /* =========================
       WIN MODALS
    ========================== */
    .win-modal{
      display:none;
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: rgba(0,0,0,.72);
      justify-content:center;
      align-items:center;
      padding: 18px 12px;
    }
    .win-modal .box{
      width: 100%;
      max-width: 520px;
      border-radius: 18px;
      background: rgba(10,10,10,.96);
      border: 1px solid rgba(80,255,160,.22);
      box-shadow:
        0 28px 90px rgba(0,0,0,.75),
        0 0 40px rgba(80,255,160,.16);
      padding: 18px 16px 16px;
      position: relative;
      overflow:hidden;
    }
    .win-modal .box::before{
      content:"";
      position:absolute;
      inset:-80px -80px auto -80px;
      height: 240px;
      background: radial-gradient(closest-side, rgba(80,255,160,.22), transparent 70%);
      filter: blur(10px);
      opacity:.9;
    }
    .win-modal h3{
      margin: 0 0 8px;
      color: rgba(80,255,160,.96);
      text-shadow: 0 0 18px rgba(80,255,160,.16);
      font-size: 1.25rem;
      position:relative;
    }
    .win-modal p{
      margin: 0;
      color: rgba(255,255,255,.86);
      line-height: 1.55;
      position:relative;
      white-space: pre-line;
    }
    .win-modal .closex{
      position:absolute;
      top: 8px;
      right: 10px;
      border:none;
      background: transparent;
      color:#fff;
      font-size: 34px;
      font-weight: 900;
      cursor:pointer;
      line-height:1;
      z-index: 2;
    }
    .win-pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(80,255,160,.28);
      background: rgba(31,107,51,.22);
      color: rgba(255,255,255,.92);
      font-weight: 1000;
      margin: 10px 0 12px;
      position:relative;
    }
    .win-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
      position:relative;
    }
  </style>
</head>

<body>
  <div class="portal-bg"></div>
  <div class="grain"></div>

  <div class="wrap">

    <!-- Minimal portal top bar -->
    <div class="topbar">
      <div class="leaf-brand">
        <div class="leaf-logo">
          <!-- Experience logo (Valentine costume) -->
          <img src="FD7AB547-3907-41B6-9529-9560297A038C.png" alt="New Leaf Mascot">
        </div>
        <div class="leaf-title">
          <strong>New Leaf Painting Co.</strong>
          <span>The Experience Portal</span>
        </div>
      </div>

      <div class="top-actions">
        <a class="nl-btn ghost" href="index.html">Home</a>
        <a class="nl-btn" href="past-projects.html">Past Projects</a>
        <a class="nl-btn primary" href="#" data-contact-open="1">Get Free Estimate</a>
      </div>
    </div>

    <!-- Portal hero -->
    <section class="hero">
      <h1>Welcome to The Experience</h1>
      <p>
        This isn‚Äôt a boring painting website. It‚Äôs a preview of what it feels like when your home gets a <b>new leaf</b> ‚Äî
        cleaner lines, brighter rooms, and work done the right way.
      </p>

      <div class="type-line" aria-label="Portal message">
        <span id="typeText"></span><span class="cursor"></span>
      </div>
    </section>

    <!-- Step 1: Pick a Leaf -->
    <section class="card" id="step1">
      <h2>1) Pick a Leaf to Unlock a Deal</h2>
      <p>One pick only. Choose wisely. (Or don‚Äôt. That‚Äôs part of the fun.)</p>

      <div class="leaf-grid" aria-label="Pick a leaf options">
        <div class="leaf-card" data-leaf="chest">
          <img src="60D479FE-6981-4386-AA4A-189873CE108B.png" alt="Leaf holding chest">
          <strong>Leaf #1</strong>
          <small>Looks expensive‚Ä¶ üëÄ</small>
        </div>

        <div class="leaf-card" data-leaf="spray">
          <img src="56AA0400-CB8D-453A-8AA5-7B4DAC1DB949.png" alt="Leaf with spray gun">
          <strong>Leaf #2</strong>
          <small>Classic pro energy</small>
        </div>

        <div class="leaf-card" data-leaf="brush">
          <img src="D20E363A-FA00-4FC9-8E07-E29E9DAB17DB.png" alt="Leaf with brush">
          <strong>Leaf #3</strong>
          <small>Old-school detail</small>
        </div>
      </div>

      <div class="deal-box" id="dealBox" aria-live="polite">
        <div class="label">‚úÖ Deal Unlocked</div>
        <p id="dealText"></p>
      </div>

      <div class="locked-note" id="lockedNote"></div>
    </section>

    <!-- Step 2: Bonus Spin -->
    <section class="card" id="step2">
      <h2>2) Bonus Spin</h2>
      <p>You already unlocked a deal. Now you get <b>one</b> bonus spin for a small extra perk (or nothing ‚Äî because real life).</p>

      <div class="wheel-wrap">
        <div class="pointer" aria-hidden="true"></div>

        <div class="wheel" id="wheel" aria-label="Spin wheel">
          <div class="wheel-center"><span>SPIN</span></div>
        </div>

        <button class="nl-btn primary" id="spinBtn" type="button">Spin Once</button>
        <div class="spin-result" id="spinResult"></div>
      </div>
    </section>

    <!-- Step 3: Ask the Leaf (quick FAQ) -->
    <section class="card" id="step3">
      <h2>3) Ask the Leaf</h2>
      <p>Tap a question. Instant answer. No endless reading.</p>

      <div style="display:grid; gap:10px; margin-top:10px;">
        <button class="nl-btn" type="button" data-q="q1">How long does an average room take?</button>
        <button class="nl-btn" type="button" data-q="q2">Do you do cabinets?</button>
        <button class="nl-btn" type="button" data-q="q3">Do you use cheap paint?</button>
        <button class="nl-btn" type="button" data-q="q4">How do I get an exact quote?</button>
      </div>

      <p id="answerOut" style="margin-top:12px; font-weight:900; color: rgba(255,255,255,.88);"></p>

      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
        <a class="nl-btn primary" href="#" data-contact-open="1">Use my deal ‚Üí Get estimate</a>
        <a class="nl-btn" href="testimonials.html">See Reviews</a>
      </div>
    </section>

    <div class="portal-footer">
      Powered by New Leaf Painting Co. ‚Ä¢ Southern Maine ‚Ä¢ ‚ÄúDifferent on purpose.‚Äù
    </div>

  </div>

  <!-- WIN MODAL (deal reveal) -->
  <div id="deal-win-modal" class="win-modal" aria-modal="true" role="dialog" aria-label="Deal unlocked">
    <div class="box">
      <button class="closex" type="button" aria-label="Close">&times;</button>
      <h3>‚úÖ You Unlocked a Deal</h3>
      <div class="win-pill">Unlocked Deal</div>
      <p id="dealModalText"></p>

      <div class="win-actions">
        <button class="nl-btn primary" id="goSpinBtn" type="button">Next ‚Üí Try Bonus Spin</button>
        <a class="nl-btn" href="#" data-contact-open="1">Use deal ‚Üí Get estimate</a>
      </div>
    </div>
  </div>

  <!-- WIN MODAL (spin result) -->
  <div id="spin-win-modal" class="win-modal" aria-modal="true" role="dialog" aria-label="Spin result">
    <div class="box">
      <button class="closex" type="button" aria-label="Close">&times;</button>
      <h3>üéâ Bonus Spin Result</h3>
      <div class="win-pill">Today‚Äôs Bonus</div>
      <p id="spinModalText"></p>

      <div class="win-actions">
        <a class="nl-btn primary" href="#" data-contact-open="1">Claim ‚Üí Get estimate</a>
        <button class="nl-btn" id="spinDoneBtn" type="button">Done</button>
      </div>
    </div>
  </div>

  <!-- Estimate Popup (standalone for this page) -->
  <div id="contact-popup" class="popup" aria-modal="true" role="dialog" aria-label="Get free estimate popup">
    <div class="popup-content">
      <button type="button" class="close" aria-label="Close">&times;</button>
      <h2>Get free estimate</h2>

      <form id="estimate-form" novalidate>
        <div class="field">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" placeholder="Your name">
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" placeholder="you@email.com">
        </div>

        <div class="field">
          <label for="phone">Phone</label>
          <input type="tel" id="phone" name="phone" placeholder="(207) 555-1234">
        </div>

        <div class="field">
          <label for="message">Message</label>
          <textarea id="message" name="message" rows="4" placeholder="Tell me what you‚Äôre looking to paint‚Ä¶"></textarea>
        </div>

        <button id="estimate-send" type="button">Send</button>
      </form>
    </div>
  </div>

  <script>
    // =========================
    // WIN MODAL helpers
    // =========================
    function openModal(modalEl){
      if (!modalEl) return;
      modalEl.style.display = "flex";
    }
    function closeModal(modalEl){
      if (!modalEl) return;
      modalEl.style.display = "none";
    }
    ["deal-win-modal","spin-win-modal"].forEach(id=>{
      const m = document.getElementById(id);
      if (!m) return;
      m.querySelector(".closex")?.addEventListener("click", ()=>closeModal(m));
      m.addEventListener("click", (e)=>{ if (e.target === m) closeModal(m); });
    });
    document.getElementById("spinDoneBtn")?.addEventListener("click", ()=>{
      closeModal(document.getElementById("spin-win-modal"));
    });

    // =========================
    // 1) Portal typing (slower + readable)
    // =========================
    (function(){
      const lines = [
        "Portal scan complete‚Ä¶ ‚úÖ",
        "You have entered: The New Leaf Experience.",
        "Pick a leaf ‚Üí unlock a deal.",
        "Then try a bonus spin‚Ä¶ if you dare."
      ];
      const el = document.getElementById("typeText");

      let i = 0;
      let j = 0;
      let deleting = false;

      const TYPE_SPEED = 38;      // slower typing
      const DELETE_SPEED = 18;    // slower delete
      const END_PAUSE = 1400;     // pause after fully typed
      const BETWEEN_LINES = 600;  // pause before next line

      function tick(){
        const target = lines[i];

        if (!deleting){
          el.textContent = target.slice(0, j++);
          if (j > target.length){
            // pause then start delete
            setTimeout(()=>{ deleting = true; tick(); }, END_PAUSE);
            return;
          }
          setTimeout(tick, TYPE_SPEED);
        } else {
          el.textContent = target.slice(0, j--);
          if (j <= 0){
            deleting = false;
            i = (i + 1) % lines.length;
            j = 0;
            setTimeout(tick, BETWEEN_LINES);
            return;
          }
          setTimeout(tick, DELETE_SPEED);
        }
      }
      tick();
    })();

    // =========================
    // 2) Pick a Leaf (one time)
    // =========================
    const leafCards = document.querySelectorAll(".leaf-card");
    const dealBox = document.getElementById("dealBox");
    const dealText = document.getElementById("dealText");
    const lockedNote = document.getElementById("lockedNote");

    const dealModal = document.getElementById("deal-win-modal");
    const dealModalText = document.getElementById("dealModalText");
    const goSpinBtn = document.getElementById("goSpinBtn");

    // Deals (edit anytime)
    const deals = [
      { title: "$150 Off Any Interior Project", body: "Valid when you book within 14 days of your estimate." },
      { title: "FREE Upgrade: Crisp Line Guarantee", body: "If we‚Äôre a fit, we include an extra detail pass on trim & cut lines." },
      { title: "$250 Off Cabinet Refresh", body: "Applies to full cabinet resprays (doors + boxes)." },
      { title: "Bonus Room Add-On Deal", body: "Book 2+ rooms and get a small bedroom at ceiling-only labor." }
    ];

    function pickDeal(){
      return deals[Math.floor(Math.random() * deals.length)];
    }

    let leafPicked = false;
    let unlockedDeal = null;

    leafCards.forEach(card=>{
      card.addEventListener("click", ()=>{
        if (leafPicked) return;

        leafPicked = true;
        unlockedDeal = pickDeal();

        // show on-page box
        dealBox.style.display = "block";
        dealText.textContent = `${unlockedDeal.title} ‚Äî ${unlockedDeal.body}`;

        // lock the rest visually
        leafCards.forEach(c=>{
          c.style.opacity = (c === card) ? "1" : ".45";
          c.style.pointerEvents = "none";
        });
        lockedNote.textContent = "‚úÖ Deal locked in. You only get one pick.";

        // show modal
        if (dealModalText){
          dealModalText.textContent = `${unlockedDeal.title}\n${unlockedDeal.body}\n\nNext: You get ONE bonus spin.`;
        }
        openModal(dealModal);
      });
    });

    goSpinBtn?.addEventListener("click", ()=>{
      closeModal(dealModal);
      document.getElementById("step2")?.scrollIntoView({behavior:"smooth", block:"start"});
    });

    // =========================
    // 3) Bonus Spin (one time)
    // =========================
    const wheel = document.getElementById("wheel");
    const spinBtn = document.getElementById("spinBtn");
    const spinResult = document.getElementById("spinResult");

    const spinModal = document.getElementById("spin-win-modal");
    const spinModalText = document.getElementById("spinModalText");

    const bonuses = [
      "‚úÖ Bonus: Extra $100 off your project.",
      "‚úÖ Bonus: FREE gallon of paint (up to $60 value) for your project.",
      "‚úÖ Bonus: 5% off labor on this job (caps at $250).",
      "‚úÖ Bonus: Priority scheduling (jump the line if possible).",
      "üòà No bonus today‚Ä¶ but your main deal is still locked in ‚úÖ",
      "üòà No bonus today‚Ä¶ but your main deal is still locked in ‚úÖ"
    ];

    let spun = false;
    let rotation = 0;

    function spinNow(){
      if (spun) return;

      if (!leafPicked){
        alert("Pick a leaf first to unlock your deal.");
        return;
      }

      spun = true;
      spinBtn.textContent = "Spinning‚Ä¶";
      spinBtn.disabled = true;

      // spin 4-6 turns + random angle
      const extraTurns = 360 * (4 + Math.floor(Math.random() * 3));
      const randomAngle = Math.floor(Math.random() * 360);
      rotation += extraTurns + randomAngle;

      wheel.style.transform = `rotate(${rotation}deg)`;

      setTimeout(() => {
        const result = bonuses[Math.floor(Math.random() * bonuses.length)];
        spinResult.textContent = result;

        // modal
        if (spinModalText){
          spinModalText.textContent = result + "\n\nIf you want to claim it, hit Get Free Estimate.";
        }
        openModal(spinModal);

        spinBtn.textContent = "Spin Used ‚úÖ";
      }, 3300);
    }

    spinBtn?.addEventListener("click", spinNow);

    // =========================
    // 4) Ask the Leaf (FAQ)
    // =========================
    const answerOut = document.getElementById("answerOut");
    const answers = {
      q1: "Most rooms take 1‚Äì2 days depending on prep, repairs, and trim detail. We‚Äôll tell you straight at the estimate.",
      q2: "Yes. Cabinet resprays are one of our specialties ‚Äî doors + boxes, done clean and durable.",
      q3: "Nope. We use quality coatings and match the right product to the surface. Cheap paint is expensive later.",
      q4: "Hit Get Free Estimate. Tell us what you‚Äôre painting + timeline. We‚Äôll set a quick walkthrough and give an exact quote."
    };

    document.querySelectorAll('[data-q]').forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const key = btn.getAttribute("data-q");
        answerOut.textContent = answers[key] || "";
      });
    });

    // =========================
    // Popup wiring (portal page only)
    // =========================
    const popup = document.getElementById("contact-popup");
    const openers = document.querySelectorAll('[data-contact-open="1"]');
    const closeBtn = popup.querySelector(".close");

    const openPopup = (e) => { if(e) e.preventDefault(); popup.style.display="flex"; };
    const closePopup = () => popup.style.display="none";

    openers.forEach(o => o.addEventListener("click", openPopup));
    closeBtn.addEventListener("click", closePopup);

    window.addEventListener("click", (e)=>{ if(e.target === popup) closePopup(); });
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closePopup(); });

    // =========================
    // Send button wiring (mailto with their info)
    // =========================
    const sendBtn = document.getElementById("estimate-send");
    sendBtn.addEventListener("click", ()=>{
      const name = (document.getElementById("name").value || "").trim();
      const email = (document.getElementById("email").value || "").trim();
      const phone = (document.getElementById("phone").value || "").trim();
      const message = (document.getElementById("message").value || "").trim();

      if (!name || (!email && !phone)) {
        alert("Please enter your name and either an email or phone number.");
        return;
      }

      const to = "newleafpaintingcompany@gmail.com";
      const subject = encodeURIComponent(`Estimate Request - ${name}${phone ? " - " + phone : ""}`);

      const body = encodeURIComponent(
`Hi Mike,

I'd like a free estimate. Here‚Äôs my info:

Name: ${name}
Email: ${email || "(not provided)"}
Phone: ${phone || "(not provided)"}

Unlocked Deal:
${unlockedDeal ? (unlockedDeal.title + " ‚Äî " + unlockedDeal.body) : "(none)"}

Message:
${message || "(no message)"}

Thanks!`
      );

      window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
      closePopup();
    });
  </script>
</body>
</html>
